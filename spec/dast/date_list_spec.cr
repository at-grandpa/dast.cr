require "../spec_helper"

describe Dast::DateList do
  describe "#to_s" do
    [
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "2018-03-23"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00','2018-03-23 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "2018-03-25"],
        expect:    "'2018-03-20 00:00:00','2018-03-22 00:00:00','2018-03-24 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%F",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "2018-03-25"],
        expect:    "'2018-03-20','2018-03-22','2018-03-24'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: " | ",
        quote:     "'",
        arguments: ["2018-03-20", "2018-03-25"],
        expect:    "'2018-03-20 00:00:00' | '2018-03-22 00:00:00' | '2018-03-24 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "\"",
        arguments: ["2018-03-20", "2018-03-25"],
        expect:    "\"2018-03-20 00:00:00\",\"2018-03-22 00:00:00\",\"2018-03-24 00:00:00\"",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018/03/20", "2018/03/25"],
        expect:    "'2018-03-20 00:00:00','2018-03-22 00:00:00','2018-03-24 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "2d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018/03/20 00:00:00", "2018/03/25 00:00:00"],
        expect:    "'2018-03-20 00:00:00','2018-03-22 00:00:00','2018-03-24 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1y",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2020-03-20 00:00:00"],
        expect:    "'2018-03-20 00:00:00','2019-03-20 00:00:00','2020-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1mon",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2018-05-20 02:00:00"],
        expect:    "'2018-03-20 00:00:00','2018-04-20 00:00:00','2018-05-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2018-03-22 00:00:00"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1h",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2018-03-20 02:00:00"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 01:00:00','2018-03-20 02:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1m",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2018-03-20 00:02:00"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 00:01:00','2018-03-20 00:02:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1s",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "2018-03-20 00:00:02"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 00:00:01','2018-03-20 00:00:02'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "3"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3", "2018-03-20"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "+3"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "+3d"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "+3day"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20", "~3"],
        expect:    "'2018-03-18 00:00:00','2018-03-19 00:00:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1m",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "~3m"],
        expect:    "'2018-03-19 23:58:00','2018-03-19 23:59:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "8d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-20 00:00:00", "~2mon"],
        expect:    "'2018-02-20 00:00:00','2018-02-28 00:00:00','2018-03-08 00:00:00','2018-03-16 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-22"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["2018-03-18"],
        expect:    "'2018-03-18 00:00:00','2018-03-19 00:00:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["~3"],
        expect:    "'2018-03-18 00:00:00','2018-03-19 00:00:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3d"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["~3d"],
        expect:    "'2018-03-18 00:00:00','2018-03-19 00:00:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1y",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3y"],
        expect:    "'2018-03-20 00:00:00','2019-03-20 00:00:00','2020-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1y",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["~3y"],
        expect:    "'2016-03-20 00:00:00','2017-03-20 00:00:00','2018-03-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1mon",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3mon"],
        expect:    "'2018-03-20 00:00:00','2018-04-20 00:00:00','2018-05-20 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3d"],
        expect:    "'2018-03-20 00:00:00','2018-03-21 00:00:00','2018-03-22 00:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1h",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3h"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 01:00:00','2018-03-20 02:00:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1m",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3m"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 00:01:00','2018-03-20 00:02:00'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1s",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: ["3s"],
        expect:    "'2018-03-20 00:00:00','2018-03-20 00:00:01','2018-03-20 00:00:02'",
      },
      {
        now:       Time.parse("2018-03-20 00:00:00", "%Y-%m-%d %H:%M:%S"),
        interval:  "1d",
        format:    "%Y-%m-%d %H:%M:%S",
        delimiter: ",",
        quote:     "'",
        arguments: [] of String,
        expect:    "'2018-03-14 00:00:00','2018-03-15 00:00:00','2018-03-16 00:00:00','2018-03-17 00:00:00','2018-03-18 00:00:00','2018-03-19 00:00:00','2018-03-20 00:00:00'",
      },
    ].each do |spec_case|
      describe "returns #{spec_case[:expect]}, " do
        it "when #{spec_case.to_h.reject { |k, _| k.to_s == "expect" }}" do
          Dast::DateList.new(
            now: spec_case[:now],
            interval: spec_case[:interval],
            format: spec_case[:format],
            delimiter: spec_case[:delimiter],
            quote: spec_case[:quote],
            arguments: spec_case[:arguments]
          ).to_s.should eq spec_case[:expect]
        end
      end
    end
    # describe "raises an Exception, " do
    #   [
    #     {
    #       arguments: ["2018-03-18", "2018-03-19", "2018-03-20"],
    #     },
    #   ].each do |spec_case|
    #     it "when #{spec_case.to_h.reject { |k, _| k.to_s == "expect" }}" do
    #       expect_raises(Exception, "Wrong number of arguments. (given #{spec_case[:arguments].size}, expected 0 or 1 or 2)") do
    #         Dast::TimeFactory.create_times(arguments: spec_case[:arguments])
    #       end
    #     end
    #   end
    # end
  end
end
